
<% if @order_type == 'ticket' %>
  <% article = @ticket_order.ticket.convention.name + " " +  @ticket_order.ticket.name %>
  <% quantity = @ticket_order.quantity %>
  <% price_per_ticket = @ticket_order.ticket.price %>
  <% amount = @ticket_order.total_price %>
<% end %>


<div id="embeddedCheckout"></div>
<script src="https://developers.mypos.com/repository/mypos-embedded-sdk.js" type="text/javascript"></script>
<script>
    var paymentParams = {
        sid: '<%=  Rails.configuration.x.mypos.sid %>',
        ipcLanguage: 'en', //Checkout page language (ISO 2 format).
        walletNumber: '<%=  Rails.configuration.x.mypos.wallet_number %>',
        amount: parseFloat("<%= amount %>"),
        currency: 'HUF',
        orderID: "<%= @order_id %>",
        urlNotify: '<%= payment_notify_url.split("?")[0] %>',
        keyIndex: parseInt('<%= Rails.configuration.x.mypos.key_index %>'),
        cartItems: [
            {
                article: '<%= article %>',
                quantity: '<%= quantity %>',
                price: '<%= price_per_ticket %>',
                currency: 'HUF',
            },
        ]
    };
    var callbackParams = {
        isSandbox: false,
        onSuccess: function (data) {
            console.log('success callback');
            console.log(data);
        },
        onError: function () {
            console.log('error');
        }
    };

    MyPOSEmbedded.createPayment(
        'embeddedCheckout',
        paymentParams,
        callbackParams
    );

</script>
